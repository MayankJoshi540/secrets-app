<%- include('partials/header') %>

<div class="min-h-screen flex flex-col items-center justify-center bg-gray-200 px-4">
  <div class="bg-white p-8 rounded-lg shadow-md w-full max-w-md text-center">
    <h1 class="text-2xl font-bold mb-4">Secrets</h1>
    <p class="mb-4 text-gray-700">Anonymously shared secrets by users:</p>

    <% if (users.length === 0) { %>
      <p class="text-gray-500">No secrets shared yet.</p>
    <% } else { %>
      <ul class="space-y-2 w-full text-left">
        <% users.forEach(user => { %>
          <% user.secret.forEach(secret => { %>
            <li class="bg-gray-100 p-2 rounded flex justify-between items-center">
              <span><%= secret %></span>
              <% if (user._id.toString() === CurrentUserId.toString()) { %>
                <form action="/edit" method="POST" class="flex items-center">
                  <input type="hidden" name="oldSecret" value="<%= secret %>">
                  <input type="text" name="newSecret" placeholder="Edit secret" class="border px-2 py-1 rounded mr-2">
                  <button type="submit">
                    <i class="fa-solid fa-pen text-gray-600 hover:text-blue-600"></i>
                  </button>
                </form>
              <% } %>
            </li>
          <% }) %>
        <% }) %>
      </ul>
    <% } %>

    <form action="/submit" method="post" class="mt-6 w-full">
      <input type="text" name="secret" class="w-full px-4 py-2 border border-black rounded mb-2" placeholder="Enter a secret" required />
      <button type="submit" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600 w-full">Submit a New Secret</button>
    </form>

    <a href="/logout" class="text-sm text-red-600 mt-6 inline-block">Logout</a>
  </div>
</div>

<%- include('partials/footer') %>
